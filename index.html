<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScoreHub Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #00ff85; --bg: #0b0e11; --card: #161b22; --border: #30363d; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; letter-spacing: -0.02em; overflow-x: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        header { background: rgba(11, 14, 17, 0.95); backdrop-blur: 12px; border-bottom: 1px solid var(--border); position: fixed; top: 0; width: 100%; max-width: 448px; z-index: 100; }
        .date-divider { position: sticky; top: 72px; background: var(--bg); z-index: 10; padding: 12px 16px; font-size: 11px; font-weight: 900; color: #8b949e; letter-spacing: 0.1em; border-bottom: 1px solid #1f2428; }
        .match-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 14px; margin: 8px 16px; display: flex; justify-content: space-between; align-items: center; }
        
        .league-tag { font-size: 8px; font-weight: 900; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; margin-bottom: 6px; display: inline-block; }
        .tag-PREM { background: #3d195d; color: white; }
        .tag-LALIGA { background: #ee252e; color: white; }
        .tag-MLS { background: #f5f5f5; color: black; }

        .score-box { background: #000; padding: 6px 12px; border-radius: 6px; font-weight: 900; display: flex; gap: 10px; border: 1px solid #21262d; min-width: 60px; justify-content: center; }
        .nav-bottom { position: fixed; bottom: 0; width: 100%; max-width: 448px; background: #161b22; border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 12px 0; z-index: 100; }
        .nav-btn { font-size: 10px; font-weight: 800; color: #8b949e; cursor: pointer; text-transform: uppercase; }
        .nav-btn.active { color: var(--accent); }
    </style>
</head>
<body class="max-w-md mx-auto pb-24">

    <header>
        <div class="p-4 flex justify-between items-center">
            <h1 class="text-xl font-black italic tracking-tighter uppercase">Score<span class="text-[#00ff85]">Hub</span></h1>
            <div id="sync-status" class="flex items-center gap-2">
                <span id="sync-label" class="text-[9px] font-bold text-zinc-500 uppercase">Live Hub</span>
                <div class="w-2 h-2 rounded-full bg-green-500"></div>
            </div>
        </div>
    </header>

    <main class="mt-20">
        <div id="tab-matches">
            <div id="unifiedMatchList"></div>
        </div>

        <div id="tab-standings" class="hidden">
            <div class="flex gap-2 px-4 py-4 overflow-x-auto no-scrollbar">
                <button onclick="renderTable('PREM')" class="text-[10px] font-black bg-zinc-800 px-4 py-2 rounded-full whitespace-nowrap">PREMIER LEAGUE</button>
                <button onclick="renderTable('LALIGA')" class="text-[10px] font-black bg-zinc-800 px-4 py-2 rounded-full whitespace-nowrap">LA LIGA</button>
                <button onclick="renderTable('MLS')" class="text-[10px] font-black bg-zinc-800 px-4 py-2 rounded-full whitespace-nowrap">MLS</button>
            </div>
            <div class="px-4 overflow-x-auto">
                <div class="bg-zinc-900/50 rounded-xl border border-zinc-800">
                    <table class="w-full text-left text-[11px]">
                        <thead class="bg-zinc-800 text-[9px] font-black text-zinc-500 uppercase">
                            <tr id="tableHead"></tr>
                        </thead>
                        <tbody id="standingsContent"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <nav class="nav-bottom">
        <div onclick="switchTab('matches')" id="nav-matches" class="nav-btn active">Main Hub</div>
        <div onclick="switchTab('standings')" id="nav-standings" class="nav-btn">Standings</div>
    </nav>

    <script>
        const SHEETS = {
            PREM: { sch: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRGHDcX_hIIzPlyqTZhiySqRNTQho5XFkyRaHqHa0tiPDC3D7zO_b3Mud054IRLzPKaHV1cERaYj3w0/pub?gid=1616061697&single=true&output=csv', tbl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRGHDcX_hIIzPlyqTZhiySqRNTQho5XFkyRaHqHa0tiPDC3D7zO_b3Mud054IRLzPKaHV1cERaYj3w0/pub?gid=935978435&single=true&output=csv' },
            LALIGA: { sch: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRGHDcX_hIIzPlyqTZhiySqRNTQho5XFkyRaHqHa0tiPDC3D7zO_b3Mud054IRLzPKaHV1cERaYj3w0/pub?gid=1516477023&single=true&output=csv', tbl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRGHDcX_hIIzPlyqTZhiySqRNTQho5XFkyRaHqHa0tiPDC3D7zO_b3Mud054IRLzPKaHV1cERaYj3w0/pub?gid=886605383&single=true&output=csv' },
            MLS: { sch: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTAT0GInc6QMrh4OdSjMk63NmcvN_1lyKpDnwYifaQBqtBMu3JAWrJRr0DqzEFt1iPbkV7vZPMOcuis/pub?gid=0&single=true&output=csv', tbl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT03H3Or-8DCxNZkAnIdhVuwJsej-AEuo6VgZO3pG4WsBYt1HPxCLN0CsGa5P33XghzKltG5AiymB4q/pub?gid=1177278404&single=true&output=csv' }
        };

        let allMatches = [];
        let tableData = {};

        // Normalizes object keys to lowercase to avoid "Date" vs "date" errors
        function normalizeRow(row) {
            const normalized = {};
            for (let key in row) normalized[key.toLowerCase().trim()] = row[key];
            return normalized;
        }

        function parseFlexibleDate(dateStr) {
            if (!dateStr) return null;
            let clean = dateStr.replace(/(\d+)(st|nd|rd|th)/i, "$1").trim();
            if (!clean.includes("2025")) clean += " 2025";
            let d = new Date(clean);
            return isNaN(d.getTime()) ? null : d;
        }

        async function initHub() {
            document.getElementById('sync-label').innerText = "Syncing...";
            const loaders = Object.keys(SHEETS).map(league => {
                return new Promise(resolve => {
                    Papa.parse(SHEETS[league].sch, {
                        download: true, header: true, skipEmptyLines: true,
                        complete: (res) => resolve(res.data.map(m => ({ ...normalizeRow(m), league: league })))
                    });
                });
            });

            const results = await Promise.all(loaders);
            allMatches = results.flat().filter(m => m.home_team || m.away_team);
            renderUnifiedMatches();
            
            Object.keys(SHEETS).forEach(l => {
                Papa.parse(SHEETS[l].tbl, { 
                    download: true, header: true, skipEmptyLines: true, 
                    complete: (res) => { tableData[l] = res.data.map(r => normalizeRow(r)); }
                });
            });
            document.getElementById('sync-label').innerText = "Live Hub";
        }

        function renderUnifiedMatches() {
            const list = document.getElementById('unifiedMatchList');
            list.innerHTML = '';
            const groups = {};
            
            allMatches.forEach(m => {
                const d = parseFlexibleDate(m.date);
                if (d) {
                    const key = d.toDateString();
                    if (!groups[key]) groups[key] = [];
                    groups[key].push(m);
                }
            });

            const sortedDates = Object.keys(groups).sort((a,b) => new Date(a) - new Date(b));
            const todayKey = new Date().toDateString();

            sortedDates.forEach(dateKey => {
                const isToday = dateKey === todayKey;
                const header = document.createElement('div');
                header.className = 'date-divider';
                if (isToday) header.id = 'scroll-target';
                header.innerText = isToday ? "TODAY" : new Date(dateKey).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }).toUpperCase();
                list.appendChild(header);

                groups[dateKey].forEach(m => {
                    list.insertAdjacentHTML('beforeend', `
                        <div class="match-card">
                            <div class="flex flex-col w-1/2">
                                <span class="league-tag tag-${m.league}">${m.league}</span>
                                <div class="flex flex-col gap-2">
                                    <div class="flex items-center gap-2"><div class="w-3 h-3 bg-zinc-800 rounded-full"></div><span class="text-xs font-bold truncate">${m.home_team || 'TBD'}</span></div>
                                    <div class="flex items-center gap-2"><div class="w-3 h-3 bg-zinc-800 rounded-full"></div><span class="text-xs font-bold truncate">${m.away_team || 'TBD'}</span></div>
                                </div>
                            </div>
                            <div class="score-box">
                                <span>${m.home_score || '-'}</span>
                                <span>${m.away_score || '-'}</span>
                            </div>
                        </div>
                    `);
                });
            });

            if (document.getElementById('scroll-target')) {
                window.scrollTo({ top: document.getElementById('scroll-target').offsetTop - 100, behavior: 'smooth' });
            }
        }

        function renderTable(league) {
            const data = tableData[league] || [];
            const head = document.getElementById('tableHead');
            const body = document.getElementById('standingsContent');
            
            // Reusable row template for W-D-L
            const getWDL = (r) => `${r.w || 0}-${r.d || 0}-${r.l || 0}`;

            if (league === 'MLS') {
                head.innerHTML = '<th class="p-3">#</th><th class="p-3">Team</th><th class="p-2">GP</th><th class="p-2 text-center">W-D-L</th><th class="p-2">GD</th><th class="p-3 text-right">PTS</th>';
                body.innerHTML = data.map(r => `
                    <tr class="border-b border-zinc-800/40 font-bold">
                        <td class="p-3 text-zinc-500">${r['#'] || ''}</td>
                        <td class="p-3 text-white truncate max-w-[100px]">${r.team || ''}</td>
                        <td class="p-2 text-zinc-400">${r.gp || 0}</td>
                        <td class="p-2 text-center text-[10px] font-mono">${getWDL(r)}</td>
                        <td class="p-2">${r.gd || 0}</td>
                        <td class="p-3 text-right text-[#00ff85] font-black">${r.pts || 0}</td>
                    </tr>`).join('');
            } else {
                head.innerHTML = '<th class="p-3">POS</th><th class="p-3">Team</th><th class="p-2">MP</th><th class="p-2 text-center">W-D-L</th><th class="p-2">GD</th><th class="p-3 text-right">PTS</th>';
                body.innerHTML = data.map(r => `
                    <tr class="border-b border-zinc-800/40 font-bold">
                        <td class="p-3 text-zinc-500">${r.position || ''}</td>
                        <td class="p-3 text-white truncate max-w-[100px]">${r.team || ''}</td>
                        <td class="p-2 text-zinc-400">${r.mp || 0}</td>
                        <td class="p-2 text-center text-[10px] font-mono">${getWDL(r)}</td>
                        <td class="p-2">${r.gd || 0}</td>
                        <td class="p-3 text-right text-[#00ff85] font-black">${r.points || 0}</td>
                    </tr>`).join('');
            }
        }

        function switchTab(tab) {
            document.getElementById('tab-matches').classList.toggle('hidden', tab !== 'matches');
            document.getElementById('tab-standings').classList.toggle('hidden', tab !== 'standings');
            document.getElementById('nav-matches').classList.toggle('active', tab === 'matches');
            document.getElementById('nav-standings').classList.toggle('active', tab === 'standings');
            if (tab === 'standings') renderTable('PREM');
        }

        initHub();
        setInterval(initHub, 60000); 
    </script>
</body>
</html>
