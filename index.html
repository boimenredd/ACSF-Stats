<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScoreHub Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #00ff85; --bg: #0b0e11; --card: #161b22; --border: #30363d; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; letter-spacing: -0.02em; overflow-x: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        header { background: rgba(11, 14, 17, 0.95); backdrop-blur: 12px; border-bottom: 1px solid var(--border); position: fixed; top: 0; width: 100%; max-width: 448px; z-index: 100; }
        
        .date-divider { position: sticky; top: 115px; background: var(--bg); z-index: 10; padding: 12px 16px; font-size: 11px; font-weight: 900; color: #8b949e; letter-spacing: 0.1em; border-bottom: 1px solid #1f2428; }
        .match-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 14px; margin: 8px 16px; display: flex; justify-content: space-between; align-items: center; }
        
        .score-box { background: #000; padding: 6px 12px; border-radius: 6px; font-weight: 900; display: flex; gap: 10px; border: 1px solid #21262d; min-width: 60px; justify-content: center; }
        .live-indicator { height: 6px; width: 6px; background: #ff453a; border-radius: 50%; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .nav-bottom { position: fixed; bottom: 0; width: 100%; max-width: 448px; background: #161b22; border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 12px 0; z-index: 100; }
        .nav-btn { font-size: 10px; font-weight: 800; color: #8b949e; cursor: pointer; text-transform: uppercase; }
        .nav-btn.active { color: var(--accent); }
        
        .league-pill { padding: 8px 16px; border-radius: 20px; font-size: 10px; font-weight: 900; white-space: nowrap; cursor: pointer; border: 1px solid transparent; }
        .league-pill.active { background: #fff; color: #000; }
        .league-pill.inactive { background: #21262d; color: #8b949e; }
    </style>
</head>
<body class="max-w-md mx-auto pb-24">

    <header>
        <div class="p-4 flex justify-between items-center">
            <h1 class="text-xl font-black italic tracking-tighter uppercase">Score<span class="text-[#00ff85]">Hub</span></h1>
            <div id="status-dot" class="flex items-center gap-2">
                <span id="sync-text" class="text-[9px] font-bold text-zinc-500 uppercase">Live</span>
                <div class="w-2 h-2 rounded-full bg-green-500"></div>
            </div>
        </div>
        
        <div class="flex gap-2 overflow-x-auto px-4 pb-4 no-scrollbar">
            <div onclick="setLeague('PREM')" id="pill-PREM" class="league-pill active">PREMIER LEAGUE</div>
            <div onclick="setLeague('LALIGA')" id="pill-LALIGA" class="league-pill inactive">LA LIGA</div>
            <div onclick="setLeague('MLS')" id="pill-MLS" class="league-pill inactive">MLS</div>
        </div>
    </header>

    <main class="mt-32">
        <div id="tab-matches">
            <div id="matchList"></div>
        </div>

        <div id="tab-standings" class="hidden px-4">
            <div class="bg-zinc-900/50 rounded-xl border border-zinc-800 overflow-hidden">
                <table class="w-full text-left text-xs">
                    <thead class="bg-zinc-800 text-[9px] font-black text-zinc-500 uppercase">
                        <tr>
                            <th class="p-3 w-10">#</th>
                            <th class="p-3">Team</th>
                            <th class="p-3 text-center">GD</th>
                            <th class="p-3 text-right">PTS</th>
                        </tr>
                    </thead>
                    <tbody id="standingsContent"></tbody>
                </table>
            </div>
        </div>
    </main>

    <nav class="nav-bottom">
        <div onclick="switchTab('matches')" id="nav-matches" class="nav-btn active">Matches</div>
        <div onclick="switchTab('standings')" id="nav-standings" class="nav-btn">Standings</div>
    </nav>

    <script>
        const SHEETS = {
            PREM: { 
                sch: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRGHDcX_hIIzPlyqTZhiySqRNTQho5XFkyRaHqHa0tiPDC3D7zO_b3Mud054IRLzPKaHV1cERaYj3w0/pub?gid=1616061697&single=true&output=csv',
                tbl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRGHDcX_hIIzPlyqTZhiySqRNTQho5XFkyRaHqHa0tiPDC3D7zO_b3Mud054IRLzPKaHV1cERaYj3w0/pub?gid=935978435&single=true&output=csv'
            },
            LALIGA: { 
                sch: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRGHDcX_hIIzPlyqTZhiySqRNTQho5XFkyRaHqHa0tiPDC3D7zO_b3Mud054IRLzPKaHV1cERaYj3w0/pub?gid=1516477023&single=true&output=csv',
                tbl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRGHDcX_hIIzPlyqTZhiySqRNTQho5XFkyRaHqHa0tiPDC3D7zO_b3Mud054IRLzPKaHV1cERaYj3w0/pub?gid=886605383&single=true&output=csv'
            },
            MLS: { 
                sch: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTAT0GInc6QMrh4OdSjMk63NmcvN_1lyKpDnwYifaQBqtBMu3JAWrJRr0DqzEFt1iPbkV7vZPMOcuis/pub?gid=0&single=true&output=csv',
                tbl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT03H3Or-8DCxNZkAnIdhVuwJsej-AEuo6VgZO3pG4WsBYt1HPxCLN0CsGa5P33XghzKltG5AiymB4q/pub?gid=1177278404&single=true&output=csv'
            }
        };

        let currentLeague = 'PREM';

        function parseFlexibleDate(dateStr) {
            if (!dateStr) return null;
            // Cleans "February 25th" -> "February 25"
            let clean = dateStr.replace(/(\d+)(st|nd|rd|th)/i, "$1").trim();
            // Ensure year is 2025 for correct date objects
            if (!clean.includes("2025")) clean += " 2025";
            const d = new Date(clean);
            return isNaN(d.getTime()) ? null : d;
        }

        async function loadAllData() {
            document.getElementById('sync-text').innerText = "Syncing...";
            const config = SHEETS[currentLeague];
            
            Papa.parse(config.sch, {
                download: true, header: true, skipEmptyLines: true,
                complete: (res) => {
                    renderMatches(res.data);
                    document.getElementById('sync-text').innerText = "Live";
                }
            });

            Papa.parse(config.tbl, {
                download: true, header: true, skipEmptyLines: true,
                complete: (res) => renderTable(res.data)
            });
        }

        function renderMatches(data) {
            const list = document.getElementById('matchList');
            list.innerHTML = '';

            // Grouping logic
            const groups = {};
            data.forEach(match => {
                const dateObj = parseFlexibleDate(match.Date);
                if (!dateObj) return;
                const key = dateObj.toDateString();
                if (!groups[key]) groups[key] = [];
                groups[key].push(match);
            });

            const today = new Date().toDateString();
            const sortedDates = Object.keys(groups).sort((a,b) => new Date(a) - new Date(b));

            if (sortedDates.length === 0) {
                list.innerHTML = '<div class="text-center p-20 text-zinc-500 text-xs font-bold uppercase">No Matches Found</div>';
                return;
            }

            sortedDates.forEach(dateKey => {
                const isToday = dateKey === today;
                const dateObj = new Date(dateKey);
                
                const header = document.createElement('div');
                header.className = 'date-divider';
                if (isToday) header.id = 'scroll-target';
                header.innerText = isToday ? "TODAY" : dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }).toUpperCase();
                list.appendChild(header);

                groups[dateKey].forEach(m => {
                    const status = (m.Status || '').toLowerCase();
                    const isLive = status === 'live';
                    const card = `
                        <div class="match-card">
                            <div class="flex flex-col gap-2 w-1/2">
                                <div class="flex items-center gap-3">
                                    <div class="w-4 h-4 bg-zinc-800 rounded-sm"></div>
                                    <span class="text-xs font-bold truncate">${m.Home_Team || 'Home'}</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="w-4 h-4 bg-zinc-800 rounded-sm"></div>
                                    <span class="text-xs font-bold truncate">${m.Away_Team || 'Away'}</span>
                                </div>
                            </div>
                            <div class="flex flex-col items-end gap-1">
                                <div class="score-box">
                                    <span class="${isLive ? 'text-[#00ff85]' : ''}">${m.Home_Score ?? '-'}</span>
                                    <span class="${isLive ? 'text-[#00ff85]' : ''}">${m.Away_Score ?? '-'}</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    ${isLive ? '<div class="live-indicator"></div>' : ''}
                                    <span class="text-[8px] font-black uppercase ${isLive ? 'text-red-500' : 'text-zinc-500'}">${m.Status || 'Scheduled'}</span>
                                </div>
                            </div>
                        </div>
                    `;
                    list.insertAdjacentHTML('beforeend', card);
                });
            });

            const target = document.getElementById('scroll-target');
            if (target) window.scrollTo({ top: target.offsetTop - 120, behavior: 'smooth' });
        }

        function renderTable(data) {
            const content = document.getElementById('standingsContent');
            // Sort by Points, then GD
            const sorted = data.sort((a, b) => {
                const ptsA = parseInt(a.PTS) || 0;
                const ptsB = parseInt(b.PTS) || 0;
                if (ptsB !== ptsA) return ptsB - ptsA;
                return (parseInt(b.GD) || 0) - (parseInt(a.GD) || 0);
            });

            content.innerHTML = sorted.map((row, i) => `
                <tr class="border-b border-zinc-800/40 hover:bg-zinc-800/20 transition">
                    <td class="p-3 font-bold text-zinc-500 text-[10px]">${i+1}</td>
                    <td class="p-3">
                        <div class="flex items-center gap-3">
                            <div class="w-4 h-4 bg-zinc-800 rounded-full"></div>
                            <span class="font-bold text-white text-[11px]">${row.Team || 'Unknown'}</span>
                        </div>
                    </td>
                    <td class="p-3 text-center text-zinc-400 font-mono text-[10px]">${row.GD || 0}</td>
                    <td class="p-3 text-right font-black text-[#00ff85] text-[11px]">${row.PTS || 0}</td>
                </tr>
            `).join('');
        }

        function setLeague(l) {
            currentLeague = l;
            document.querySelectorAll('.league-pill').forEach(p => {
                p.classList.replace('active', 'inactive');
                if (p.id === `pill-${l}`) p.classList.replace('inactive', 'active');
            });
            loadAllData();
        }

        function switchTab(tab) {
            document.getElementById('tab-matches').classList.toggle('hidden', tab !== 'matches');
            document.getElementById('tab-standings').classList.toggle('hidden', tab !== 'standings');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.toggle('active', b.id === `nav-${tab}`));
        }

        loadAllData();
        setInterval(loadAllData, 30000); 
    </script>
</body>
</html>
